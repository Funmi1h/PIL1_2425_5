{% extends 'base.html' %}
{% block title %}Mon Tableau de Bord - Go Together{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Bienvenue sur votre Tableau de Bord, {{ user.username }} !</h2>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {# Section pour les SUGGESTIONS DE TRAJETS (pour les passagers) #}
    <div class="card mb-4 shadow">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="bi bi-compass"></i> Suggestions de Trajets pour Vous (en tant que Passager)</h5>
        </div>
        <div class="card-body">
            {% if suggestions_passagers_error %}
                <div class="alert alert-warning">{{ suggestions_passagers_error }}</div>
            {% elif suggestions_passagers %}
                <div class="row">
                    {% for suggestion in suggestions_passagers %}
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 border-info">
                                <div class="card-body">
                                    <h6 class="card-title">De: {{ suggestion.adresse_depart }} à: {{ suggestion.adresse_arrivee }}</h6>
                                    <p class="card-text"><small class="text-muted">Date: {{ suggestion.date_depart|date:"d/m/Y" }} à {{ suggestion.heure_depart_prevue|time:"H:i" }}</small></p>
                                    <p class="card-text">Places disponibles: <span class="badge bg-primary">{{ suggestion.nombre_de_places_disponibles }}</span></p>
                                    
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>Aucune suggestion de trajet pour le moment en tant que passager.</p>
            {% endif %}
        </div>
    </div>

    {# Section pour les SUGGESTIONS DE PASSAGERS (pour les conducteurs) #}
    <div class="card mb-4 shadow">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="bi bi-people"></i> Suggestions de Passagers pour Vos Trajets (en tant que Conducteur)</h5>
        </div>
        <div class="card-body">
            {% if suggestions_conducteur_error %}
                <div class="alert alert-warning">{{ suggestions_conducteur_error }}</div>
            {% elif suggestions_conducteur %}
                <div class="row">
                    {% for suggestion in suggestions_conducteur %}
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 border-success">
                                <div class="card-body">
                                    <h6 class="card-title">Passager: {{ suggestion.passager.utilisateur.username }}</h6>
                                    <p class="card-text"><small class="text-muted">Recherche de: {{ suggestion.adresse_depart }} à: {{ suggestion.adresse_arrivee }}</small></p>
                                    <p class="card-text">Pour le: <span class="badge bg-success">{{ suggestion.date_depart_preferee|date:"d/m/Y" }}</span></p>
                                    
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>Aucune suggestion de passagers pour le moment en tant que conducteur.</p>
            {% endif %}
        </div>
    </div>

    {# --- Section : Derniers Trajets Offerts (pour les conducteurs) --- #}
    <div class="card mb-4 shadow">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-geo-alt-fill"></i> Vos Derniers Trajets Offerts</h5>
        </div>
        <div class="card-body">
            {% if derniers_trajets_offerts_error %}
                <div class="alert alert-warning">{{ derniers_trajets_offerts_error }}</div>
            {% elif derniers_trajets_offerts %}
                <ul class="list-group list-group-flush">
                    {% for trajet in derniers_trajets_offerts %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                De: <strong>{{ trajet.adresse_depart }}</strong> à: <strong>{% if trajet.adresse_arrivee %}{{ trajet.adresse_arrivee }}{% else %}destination non spécifiée{% endif %}</strong>
                                le {{ trajet.date_depart|date:"d/m/Y" }} à {{ trajet.heure_depart_prevue|time:"H:i" }}
                            </span>
                           
                        </li>
                    {% endfor %}
                </ul>
                <div class="text-center mt-3">
                    <a href="{% url 'mes_trajets_offerts' %}" class="btn btn-sm btn-link">Voir tous mes trajets offerts</a>
                </div>
            {% else %}
                <p>Vous n'avez pas encore proposé de trajets.</p>
            {% endif %}
        </div>
    </div>

    {# --- Section : Dernières Recherches de Trajets (pour les passagers) --- #}
    <div class="card mb-4 shadow">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0"><i class="bi bi-search"></i> Vos Dernières Recherches de Trajets</h5>
        </div>
        <div class="card-body">
            {% if dernieres_recherches_trajets_error %}
                <div class="alert alert-warning">{{ dernieres_recherches_trajets_error }}</div>
            {% elif dernieres_recherches_trajets %}
                <ul class="list-group list-group-flush">
                    {% for recherche in dernieres_recherches_trajets %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                Recherche de: <strong>{{ recherche.adresse_depart }}</strong> à: <strong>{% if recherche.adresse_arrivee %}{{ recherche.adresse_arrivee }}{% else %}destination non spécifiée{% endif %}</strong>
                                pour le {{ recherche.date_recherche|date:"d/m/Y" }} (préféré: {{ recherche.heure_depart_preferee|time:"H:i" }})
                            </span>
                            <a href="{% url 'detail_recherche_passager' recherche.id %}" class="btn btn-sm btn-outline-secondary">Détails</a>
                        </li>
                    {% endfor %}
                </ul>
                <div class="text-center mt-3">
                    <a href="{% url 'mes_trajets_recherches' %}" class="btn btn-sm btn-link">Voir toutes mes recherches</a>
                </div>
            {% else %}
                <p>Vous n'avez pas encore effectué de recherches de trajets.</p>
            {% endif %}
        </div>
    </div>

    {# Boutons d'action principaux #}
    <div class="mt-4 text-center">
        <a href="{% url 'proposer_trajet' %}" class="btn btn-lg btn-primary me-2"><i class="bi bi-plus-circle-fill"></i> Proposer un Trajet</a>
        <a href="#" class="btn btn-lg btn-info"><i class="bi bi-search"></i> Rechercher un Trajet</a>
    </div>

</div>
{% endblock %}