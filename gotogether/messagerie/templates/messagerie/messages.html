{% extends 'base.html' %}

{% block head %}
<style>
  .suggestions {
    margin-top: 3rem;
  }
  .suggestion_user {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border: 1px solid #e5e5e5;
    border-radius: 6px;
    margin-bottom: 12px;
    text-decoration: none;
    color: inherit;
    transition: background-color 0.2s ease;
  }
  .suggestion_user:hover {
    background-color: #f8f9fa;
  }
  .suggestion_user img, .suggestion_user ion-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0;
  }
  .suggestion_user .info {
    display: flex;
    flex-direction: column;
  }
  .suggestion_user .info strong {
    font-weight: 600;
  }
  .suggestion_user .info small {
    color: #6c757d;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <h1>Vos Messages</h1>
  <p>Commencez par discuter avec d'autres utilisateurs</p>

  {% if user_data %}
    <ul class="all_users">
      {% for item in user_data %}
        <a href="{% url 'chat_room' item.user.id %}" class="each_user d-block mb-3">
          <strong>{{ item.user.first_name }} {{ item.user.last_name }}</strong><br>
          {% if item.last_message %}
            <small class="text-muted">{{ item.last_message.content|truncatechars:50 }}</small><br>
            <small class="text-muted fst-italic">{{ item.last_message.timestamp|date:"d/m/Y H:i" }}</small>
          {% else %}
            <small class="text-muted">Aucun message</small>
          {% endif %}
        </a>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">Vous n'avez pas encore de conversations.</p>
  {% endif %}

  {% if suggested_users %}
  <div class="suggestions">
    <h2>Suggestions dâ€™utilisateurs avec qui discuter</h2>
    {% for user in suggested_users %}
      <a href="{% url 'chat_room' user.id %}" class="suggestion_user">
        {% if user.photo_profil %}
          <img src="{{ user.photo_profil.url }}" alt="{{ user.first_name }} {{ user.last_name }}">
        {% else %}
          <ion-icon name="person-circle-outline"></ion-icon>
        {% endif %}
        <div class="info">
          <strong>{{ user.first_name }} {{ user.last_name }}</strong>
          <small>{{ user.role }}</small>
        </div>
      </a>
    {% endfor %}
  </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const badge = document.getElementById('message-notif-badge');
    if (badge) badge.classList.add('d-none');
  });
</script>
{% endblock %}
